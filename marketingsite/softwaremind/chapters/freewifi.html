

<!doctype html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Free Wi-Fi &#8212; TheDevManual 0.0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/devmanual.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="top" title="TheDevManual 0.0.1 documentation" href="../index.html" />
    <link rel="next" title="&lt;no title&gt;" href="highAvailability.html" />
    <link rel="prev" title="Also distributed filesystems - cephfs, HDFS, GLUSTER" href="filesharing.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head>
  <body role="document">

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <div class="section" id="free-wi-fi">
<h1>Free Wi-Fi<a class="headerlink" href="#free-wi-fi" title="Permalink to this headline">Â¶</a></h1>
<hr class="docutils" />
<p>It is increasingly hard to find wifi hardware that supports
free-as-in-speech drivers - that is finding a USB wifi dongle for your
laptop is becoming impossible.  So I went to the <a class="reference external" href="https://www.fsf.org/resources/hw/endorsement/tehnoetic">FSF approved</a> company
<a class="reference external" href="https://tehnoetic.com/">Tehnoetic</a> and put down some hard-earned
for a mini-dongle and a high gain dongle and antenna that assuredly will
be using a chipset that has a free driver.</p>
<p>Excitedly I am sitting in a cafe about to plug them in, and why not blog about it.</p>
<p>Plugging in the mini-dongle, I get</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span>  <span class="mf">502.208147</span><span class="p">]</span> <span class="n">usb</span> <span class="mi">5</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span> <span class="n">new</span> <span class="n">high</span><span class="o">-</span><span class="n">speed</span> <span class="n">USB</span> <span class="n">device</span> <span class="n">number</span> <span class="mi">5</span> <span class="n">using</span> <span class="n">ehci</span><span class="o">-</span><span class="n">pci</span>
<span class="p">[</span>  <span class="mf">502.356966</span><span class="p">]</span> <span class="n">usb</span> <span class="mi">5</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span> <span class="n">New</span> <span class="n">USB</span> <span class="n">device</span> <span class="n">found</span><span class="p">,</span> <span class="n">idVendor</span><span class="o">=</span><span class="mi">0</span><span class="n">cf3</span><span class="p">,</span> <span class="n">idProduct</span><span class="o">=</span><span class="mi">9271</span>
<span class="p">[</span>  <span class="mf">502.356981</span><span class="p">]</span> <span class="n">usb</span> <span class="mi">5</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span> <span class="n">New</span> <span class="n">USB</span> <span class="n">device</span> <span class="n">strings</span><span class="p">:</span> <span class="n">Mfr</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">Product</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">SerialNumber</span><span class="o">=</span><span class="mi">48</span>
<span class="p">[</span>  <span class="mf">502.356991</span><span class="p">]</span> <span class="n">usb</span> <span class="mi">5</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span> <span class="n">Product</span><span class="p">:</span> <span class="n">UB93</span>
<span class="p">[</span>  <span class="mf">502.356999</span><span class="p">]</span> <span class="n">usb</span> <span class="mi">5</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span> <span class="n">Manufacturer</span><span class="p">:</span> <span class="n">ATHEROS</span>
<span class="p">[</span>  <span class="mf">502.357007</span><span class="p">]</span> <span class="n">usb</span> <span class="mi">5</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span> <span class="n">SerialNumber</span><span class="p">:</span> <span class="mi">12345</span>
<span class="p">[</span>  <span class="mf">502.770802</span><span class="p">]</span> <span class="n">usb</span> <span class="mi">5</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span> <span class="n">ath9k_htc</span><span class="p">:</span> <span class="n">Firmware</span> <span class="n">htc_9271</span><span class="o">.</span><span class="n">fw</span> <span class="n">requested</span>
<span class="p">[</span>  <span class="mf">502.770879</span><span class="p">]</span> <span class="n">usb</span> <span class="mi">5</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span> <span class="n">firmware</span><span class="p">:</span> <span class="n">failed</span> <span class="n">to</span> <span class="n">load</span> <span class="n">htc_9271</span><span class="o">.</span><span class="n">fw</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
<span class="p">[</span>  <span class="mf">502.770891</span><span class="p">]</span> <span class="n">usb</span> <span class="mi">5</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span> <span class="n">Direct</span> <span class="n">firmware</span> <span class="n">load</span> <span class="n">failed</span> <span class="k">with</span> <span class="n">error</span> <span class="o">-</span><span class="mi">2</span>
<span class="p">[</span>  <span class="mf">502.770898</span><span class="p">]</span> <span class="n">usb</span> <span class="mi">5</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span> <span class="n">Falling</span> <span class="n">back</span> <span class="n">to</span> <span class="n">user</span> <span class="n">helper</span>
<span class="p">[</span>  <span class="mf">502.771133</span><span class="p">]</span> <span class="n">usbcore</span><span class="p">:</span> <span class="n">registered</span> <span class="n">new</span> <span class="n">interface</span> <span class="n">driver</span> <span class="n">ath9k_htc</span>
<span class="p">[</span>  <span class="mf">502.775096</span><span class="p">]</span> <span class="n">usb</span> <span class="mi">5</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span> <span class="n">ath9k_htc</span><span class="p">:</span> <span class="n">USB</span> <span class="n">layer</span> <span class="n">deinitialized</span>
</pre></div>
</div>
<p>Hmmm.</p>
<p>Lets start by confirming what <cite>dmesg</cite> tells us - what is the USB device.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Bus</span> <span class="mi">005</span> <span class="n">Device</span> <span class="mi">005</span><span class="p">:</span> <span class="n">ID</span> <span class="mi">0</span><span class="n">cf3</span><span class="p">:</span><span class="mi">9271</span> <span class="n">Atheros</span> <span class="n">Communications</span><span class="p">,</span> <span class="n">Inc</span><span class="o">.</span> <span class="n">AR9271</span> <span class="mf">802.11</span><span class="n">n</span>
</pre></div>
</div>
<p>OK. So its the AR9271 chipset, which apparently uses the ath9k_htc driver.
Aha the online blurb (on my iPhone!) tells me &#8216;firmware is required&#8217;</p>
<p>Great, I need a binary firmware (presumably on the Atheros chipset) to run my free driver.
This is silly guys. Its the 21C!  I really am worried about the state of wifi support in the
F/OSS world.</p>
<p>So , I dutifully tether my iPhone with my old-and-not-free dongle, and <cite>apt-get install firmware-atheros</cite></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="mf">1915.380977</span><span class="p">]</span> <span class="n">usb</span> <span class="mi">5</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span> <span class="n">Manufacturer</span><span class="p">:</span> <span class="n">ATHEROS</span>
<span class="p">[</span> <span class="mf">1915.380985</span><span class="p">]</span> <span class="n">usb</span> <span class="mi">5</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span> <span class="n">SerialNumber</span><span class="p">:</span> <span class="mi">12345</span>
<span class="p">[</span> <span class="mf">1915.381969</span><span class="p">]</span> <span class="n">usb</span> <span class="mi">5</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span> <span class="n">ath9k_htc</span><span class="p">:</span> <span class="n">Firmware</span> <span class="n">htc_9271</span><span class="o">.</span><span class="n">fw</span> <span class="n">requested</span>
<span class="p">[</span> <span class="mf">1915.400560</span><span class="p">]</span> <span class="n">usb</span> <span class="mi">5</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span> <span class="n">firmware</span><span class="p">:</span> <span class="n">direct</span><span class="o">-</span><span class="n">loading</span> <span class="n">firmware</span> <span class="n">htc_9271</span><span class="o">.</span><span class="n">fw</span>
<span class="p">[</span> <span class="mf">1915.682688</span><span class="p">]</span> <span class="n">usb</span> <span class="mi">5</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span> <span class="n">ath9k_htc</span><span class="p">:</span> <span class="n">Transferred</span> <span class="n">FW</span><span class="p">:</span> <span class="n">htc_9271</span><span class="o">.</span><span class="n">fw</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="mi">51272</span>
<span class="p">[</span> <span class="mf">1915.920587</span><span class="p">]</span> <span class="n">ath9k_htc</span> <span class="mi">5</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span><span class="mf">1.0</span><span class="p">:</span> <span class="n">ath9k_htc</span><span class="p">:</span> <span class="n">HTC</span> <span class="n">initialized</span> <span class="k">with</span> <span class="mi">33</span> <span class="n">credits</span>
<span class="p">[</span> <span class="mf">1916.195731</span><span class="p">]</span> <span class="n">ath9k_htc</span> <span class="mi">5</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span><span class="mf">1.0</span><span class="p">:</span> <span class="n">ath9k_htc</span><span class="p">:</span> <span class="n">FW</span> <span class="n">Version</span><span class="p">:</span> <span class="mf">1.3</span>
<span class="p">[</span> <span class="mf">1916.195744</span><span class="p">]</span> <span class="n">ath</span><span class="p">:</span> <span class="n">EEPROM</span> <span class="n">regdomain</span><span class="p">:</span> <span class="mh">0x65</span>
<span class="p">[</span> <span class="mf">1916.195751</span><span class="p">]</span> <span class="n">ath</span><span class="p">:</span> <span class="n">EEPROM</span> <span class="n">indicates</span> <span class="n">we</span> <span class="n">should</span> <span class="n">expect</span> <span class="n">a</span> <span class="n">direct</span> <span class="n">regpair</span> <span class="nb">map</span>
<span class="p">[</span> <span class="mf">1916.195760</span><span class="p">]</span> <span class="n">ath</span><span class="p">:</span> <span class="n">Country</span> <span class="n">alpha2</span> <span class="n">being</span> <span class="n">used</span><span class="p">:</span> <span class="mi">00</span>
<span class="p">[</span> <span class="mf">1916.195770</span><span class="p">]</span> <span class="n">ath</span><span class="p">:</span> <span class="n">Regpair</span> <span class="n">used</span><span class="p">:</span> <span class="mh">0x65</span>
<span class="p">[</span> <span class="mf">1916.200591</span><span class="p">]</span> <span class="n">ath</span><span class="p">:</span> <span class="n">EEPROM</span> <span class="n">regdomain</span><span class="p">:</span> <span class="mh">0x833a</span>
<span class="p">[</span> <span class="mf">1916.200600</span><span class="p">]</span> <span class="n">ath</span><span class="p">:</span> <span class="n">EEPROM</span> <span class="n">indicates</span> <span class="n">we</span> <span class="n">should</span> <span class="n">expect</span> <span class="n">a</span> <span class="n">country</span> <span class="n">code</span>
<span class="p">[</span> <span class="mf">1916.200606</span><span class="p">]</span> <span class="n">ath</span><span class="p">:</span> <span class="n">doing</span> <span class="n">EEPROM</span> <span class="n">country</span><span class="o">-&gt;</span><span class="n">regdmn</span> <span class="nb">map</span> <span class="n">search</span>
<span class="p">[</span> <span class="mf">1916.200612</span><span class="p">]</span> <span class="n">ath</span><span class="p">:</span> <span class="n">country</span> <span class="n">maps</span> <span class="n">to</span> <span class="n">regdmn</span> <span class="n">code</span><span class="p">:</span> <span class="mh">0x37</span>
<span class="p">[</span> <span class="mf">1916.200617</span><span class="p">]</span> <span class="n">ath</span><span class="p">:</span> <span class="n">Country</span> <span class="n">alpha2</span> <span class="n">being</span> <span class="n">used</span><span class="p">:</span> <span class="n">GB</span>
<span class="p">[</span> <span class="mf">1916.200621</span><span class="p">]</span> <span class="n">ath</span><span class="p">:</span> <span class="n">Regpair</span> <span class="n">used</span><span class="p">:</span> <span class="mh">0x37</span>
<span class="p">[</span> <span class="mf">1916.200626</span><span class="p">]</span> <span class="n">ath</span><span class="p">:</span> <span class="n">regdomain</span> <span class="mh">0x833a</span> <span class="n">dynamically</span> <span class="n">updated</span> <span class="n">by</span> <span class="n">country</span> <span class="n">IE</span>
<span class="p">[</span> <span class="mf">1916.202135</span><span class="p">]</span> <span class="n">ieee80211</span> <span class="n">phy2</span><span class="p">:</span> <span class="n">Atheros</span> <span class="n">AR9271</span> <span class="n">Rev</span><span class="p">:</span><span class="mi">1</span>
<span class="p">[</span> <span class="mf">1916.520638</span><span class="p">]</span> <span class="n">systemd</span><span class="o">-</span><span class="n">udevd</span><span class="p">[</span><span class="mi">3209</span><span class="p">]:</span> <span class="n">renamed</span> <span class="n">network</span> <span class="n">interface</span> <span class="n">wlan0</span> <span class="n">to</span> <span class="n">wlan3</span>
</pre></div>
</div>
<p>horaah - it loads the firmware OK. And renames wlan for some reason.
Ok, <cite>udev</cite> is the Linux device manager, and it is the one responsible for loading the firmware
and generally dealing with devices attached to the system buses.</p>
<p>udev generates rules (/lib/udev/rules.d/...) and those rules are stored in (/etc/udev/rules.d/70-persistent-net.rules) and they show me</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># USB device 0x:0x (rt73usb)</span>
<span class="n">SUBSYSTEM</span><span class="o">==</span><span class="s2">&quot;net&quot;</span><span class="p">,</span> <span class="n">ACTION</span><span class="o">==</span><span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="n">DRIVERS</span><span class="o">==</span><span class="s2">&quot;?*&quot;</span><span class="p">,</span> <span class="n">ATTR</span><span class="p">{</span><span class="n">address</span><span class="p">}</span><span class="o">==</span><span class="s2">&quot;00:22:75:fd:d7:8a&quot;</span><span class="p">,</span> <span class="n">ATTR</span><span class="p">{</span><span class="n">dev_id</span><span class="p">}</span><span class="o">==</span><span class="s2">&quot;0x0&quot;</span><span class="p">,</span> <span class="n">ATTR</span><span class="p">{</span><span class="nb">type</span><span class="p">}</span><span class="o">==</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="n">KERNEL</span><span class="o">==</span><span class="s2">&quot;wlan*&quot;</span><span class="p">,</span> <span class="n">NAME</span><span class="o">=</span><span class="s2">&quot;wlan2&quot;</span>

<span class="c1"># USB device 0x:0x (ath9k_htc)</span>
<span class="n">SUBSYSTEM</span><span class="o">==</span><span class="s2">&quot;net&quot;</span><span class="p">,</span> <span class="n">ACTION</span><span class="o">==</span><span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="n">DRIVERS</span><span class="o">==</span><span class="s2">&quot;?*&quot;</span><span class="p">,</span> <span class="n">ATTR</span><span class="p">{</span><span class="n">address</span><span class="p">}</span><span class="o">==</span><span class="s2">&quot;60:02:b4:99:94:c5&quot;</span><span class="p">,</span> <span class="n">ATTR</span><span class="p">{</span><span class="n">dev_id</span><span class="p">}</span><span class="o">==</span><span class="s2">&quot;0x0&quot;</span><span class="p">,</span> <span class="n">ATTR</span><span class="p">{</span><span class="nb">type</span><span class="p">}</span><span class="o">==</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="n">KERNEL</span><span class="o">==</span><span class="s2">&quot;wlan*&quot;</span><span class="p">,</span> <span class="n">NAME</span><span class="o">=</span><span class="s2">&quot;wlan3&quot;</span>
</pre></div>
</div>
<p>So the rules are written each time a new wlan device is found, and the
match is based on the, obviously now i think about it, MAC address of
the device.</p>
<p>Killing off the previous rules and re-plugging does the needful and I have wlan0 back.
I then rerun my tethering script and all is well with the world.  uploading this blog post ... now !</p>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2015, Paul Brian.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.8.
    </div>
  </body>
</html>