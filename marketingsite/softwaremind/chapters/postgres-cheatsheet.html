

<!doctype html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>PostgreSQL Cheat Sheet &#8212; TheDevManual 0.0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/devmanual.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="top" title="TheDevManual 0.0.1 documentation" href="../index.html" />
    <link rel="next" title="pxe boot" href="pxeboot.html" />
    <link rel="prev" title="Simple Podcasting" href="podcast.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head>
  <body role="document">

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <div class="section" id="postgresql-cheat-sheet">
<h1>PostgreSQL Cheat Sheet<a class="headerlink" href="#postgresql-cheat-sheet" title="Permalink to this headline">¶</a></h1>
<p>I am sure I stole this from somewhere but I cannot find the source.
Please take this with a degree of plagarism.</p>
<p>Start off:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">DATABASE</span> <span class="n">dbName</span><span class="p">;</span>

<span class="n">CREATE</span> <span class="n">TABLE</span> <span class="p">(</span><span class="k">with</span> <span class="n">auto</span> <span class="n">numbering</span> <span class="n">integer</span> <span class="nb">id</span><span class="p">)</span>

<span class="n">CREATE</span> <span class="n">TABLE</span> <span class="n">tableName</span> <span class="p">(</span>
 <span class="nb">id</span> <span class="n">serial</span> <span class="n">PRIMARY</span> <span class="n">KEY</span><span class="p">,</span>
 <span class="n">name</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="n">UNIQUE</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">,</span>
 <span class="n">dateCreated</span> <span class="n">timestamp</span> <span class="n">DEFAULT</span> <span class="n">current_timestamp</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Add a primary key:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ALTER</span> <span class="n">TABLE</span> <span class="n">tableName</span> <span class="n">ADD</span> <span class="n">PRIMARY</span> <span class="n">KEY</span> <span class="p">(</span><span class="nb">id</span><span class="p">);</span>
</pre></div>
</div>
<p>Create an INDEX:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">UNIQUE</span> <span class="n">INDEX</span> <span class="n">indexName</span> <span class="n">ON</span> <span class="n">tableName</span> <span class="p">(</span><span class="n">columnNames</span><span class="p">);</span>
</pre></div>
</div>
<p>Backup a database (command line):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">pg_dump</span> <span class="n">dbName</span> <span class="o">&gt;</span> <span class="n">dbName</span><span class="o">.</span><span class="n">sql</span>
</pre></div>
</div>
<p>Backup all databases (command line):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">pg_dumpall</span> <span class="o">&gt;</span> <span class="n">pgbackup</span><span class="o">.</span><span class="n">sql</span>
</pre></div>
</div>
<p>Run a SQL script (command line):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">psql</span> <span class="o">-</span><span class="n">f</span> <span class="n">script</span><span class="o">.</span><span class="n">sql</span> <span class="n">databaseName</span>
</pre></div>
</div>
<p>Search using a regular expression:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">column</span> <span class="n">FROM</span> <span class="n">table</span> <span class="n">WHERE</span> <span class="n">column</span> <span class="o">~</span> <span class="s1">&#39;foo.*&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>The first N records:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">columns</span> <span class="n">FROM</span> <span class="n">table</span> <span class="n">LIMIT</span> <span class="mi">10</span><span class="p">;</span>
</pre></div>
</div>
<p>Pagination:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">cols</span> <span class="n">FROM</span> <span class="n">table</span> <span class="n">LIMIT</span> <span class="mi">10</span> <span class="n">OFFSET</span> <span class="mi">30</span><span class="p">;</span>
</pre></div>
</div>
<p>Prepared Statements:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>PREPARE preparedInsert (int, varchar) AS
  INSERT INTO tableName (intColumn, charColumn) VALUES ($1, $2);
EXECUTE preparedInsert (1,&#39;a&#39;);
EXECUTE preparedInsert (2,&#39;b&#39;);
DEALLOCATE preparedInsert;
</pre></div>
</div>
<p>Create a Function:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">OR</span> <span class="n">REPLACE</span> <span class="n">FUNCTION</span> <span class="n">month</span> <span class="p">(</span><span class="n">timestamp</span><span class="p">)</span> <span class="n">RETURNS</span> <span class="n">integer</span>
 <span class="n">AS</span> <span class="s1">&#39;SELECT date_part(&#39;&#39;month&#39;&#39;, $1)::integer;&#39;</span>
<span class="n">LANGUAGE</span> <span class="s1">&#39;sql&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>Table Maintenance:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">VACUUM</span> <span class="n">ANALYZE</span> <span class="n">table</span><span class="p">;</span>
</pre></div>
</div>
<p>Reindex a database, table or index:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">REINDEX</span> <span class="n">DATABASE</span> <span class="n">dbName</span><span class="p">;</span>
</pre></div>
</div>
<p>Show query plan:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">EXPLAIN</span> <span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">table</span><span class="p">;</span>
</pre></div>
</div>
<p>Import from a file:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">COPY</span> <span class="n">destTable</span> <span class="n">FROM</span> <span class="s1">&#39;/tmp/somefile&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>Show all runtime parameters:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">SHOW</span> <span class="n">ALL</span><span class="p">;</span>
</pre></div>
</div>
<p>Grant all permissions to a user:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">GRANT</span> <span class="n">ALL</span> <span class="n">PRIVILEGES</span> <span class="n">ON</span> <span class="n">table</span> <span class="n">TO</span> <span class="n">username</span><span class="p">;</span>
</pre></div>
</div>
<p>Perform a transaction:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">BEGIN</span> <span class="n">TRANSACTION</span>
 <span class="n">UPDATE</span> <span class="n">accounts</span> <span class="n">SET</span> <span class="n">balance</span> <span class="o">+=</span> <span class="mi">50</span> <span class="n">WHERE</span> <span class="nb">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">COMMIT</span><span class="p">;</span>
</pre></div>
</div>
<div class="section" id="basic-sql">
<h2>Basic SQL<a class="headerlink" href="#basic-sql" title="Permalink to this headline">¶</a></h2>
<p>Get all columns and rows from a table:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">table</span><span class="p">;</span>
</pre></div>
</div>
<p>Add a new row:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">table</span> <span class="p">(</span><span class="n">column1</span><span class="p">,</span><span class="n">column2</span><span class="p">)</span>
<span class="n">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Update a row:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">UPDATE</span> <span class="n">table</span> <span class="n">SET</span> <span class="n">foo</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span> <span class="n">WHERE</span> <span class="nb">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
<p>Delete a row</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>DELETE FROM table WHERE id = 1;

===========================
Using PostgreSQL on FreeBSD
===========================




Find enum types::



  dbtest=&gt; SELECT pg_type.typname AS enumtype,
  dbtest-&gt;      pg_enum.enumlabel AS enumlabel
  dbtest-&gt;  FROM pg_type
  dbtest-&gt;  JOIN pg_enum
  dbtest-&gt;      ON pg_enum.enumtypid = pg_type.oid;

     enumtype   | enumlabel
  --------------+------------
   cnxrole_type | author
   cnxrole_type | maintainer
   cnxrole_type | copyright
  (3 rows)



Setting up postgres on FreeBSD
------------------------------

::

  $ make install clean
  $ /usr/local/bin/postgres -D /usr/local/pgsql/data


for some reason everything gets put into /usr/local/pgsql/data - the config
files and so on.


Configuration and users
-----------------------

* postgresql.conf

For local service::

    listen_addresses = &#39;localhost&#39;

and in pg_hba.conf::

    host    all             all             127.0.0.1/32            md5

We change ``trust`` to ``md5`` so that it exxpects user/password




$ createuser -sdrP test1
Enter password for new role:
Enter it again:


pgsql$ sudo su - pgsql
$ /usr/local/bin/createdb dbtest -O test1 encoding=UNICODE
$

$ psql -U test1 -d dbtest
...
dbtest=# CREATE USER repo WITH PASSWORD &#39;repopass&#39;;
CREATE ROLE
dbtest=# GRANT ALL PRIVILEGES ON DATABASE dbtest to repo;
GRANT


pgsql$ psql -h 127.0.0.1 -U repo -d dbtest
Password for user repo:
psql (9.2.1)
Type &quot;help&quot; for help.

dbtest=&gt;


(NB localhost will try to use Unix domain sockets so use 127.0.0.1)


For network server::

    listen_addresses = &#39;*&#39;



Logging
-------
Normally we want to ::

  log_destination = &#39;syslog&#39;
  logging_collector = off

For development purposes we usually want to watch the SQL fly past::

  log_destination = &#39;stderr&#39;
  logging_collector = on
  log_directory = &#39;pg_log&#39;
  log_filename = &#39;postgresql-%Y-%m-%d_%H%M%S.log&#39;

  log_statement = &#39;all&#39;
</pre></div>
</div>
</div>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2015, Paul Brian.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.8.
    </div>
  </body>
</html>